<!DOCTYPE html> 
<html>
<head>
<title>Animated Quicksort</title>
<style>

  
body  { margin-top:0; }

h2 { padding:0; margin-bottom:0 }
ul  { list-style-type: none;padding:12px 0px; }
ul  li { border:1px solid gray; display:inline-block; width:30px; text-align:center; margin-left:-1px; position:relative} 
 
.info { margin-top: 12px; margin-right:8px;padding-right:10px; border:1px solid gray; 
        float:left; background-color: black; color:white; min-width:72px; text-align:center;}
.pivot { color:red; opacity:0.8}
label {  width:100px; margin-top:8px;}

 button { margin-top:26px; margin-left:16px; padding:2px 8px; height:28px;}
 

 #arr0 , #arr1 { position:absolute; top:-1.5em; left:10px;  padding:0; margin:0;  } 

 #arr0 { color: blue; }
 #arr1 { color: red; } 

.finalarray { padding:6px 4px; border:1px solid red; margin:0; display:inline-block; }
   

</style>

</head>
<body> 
<h2>Animated Quicksort</h2>
<div>
<label>Input Size <select id="inpSize" >
<option  value="11" >11</option>
<option  value="20" >20</option>
<option  value="30" >30</option>
</select>
</label>

<label>Input Type<select id="inpData" >
<option  value="Predefined" >Predefined</option>
<option  value="Random" >Random</option>
<option  value="SortedAs" >Sorted Asc</option>
<option  value="SortedDs" >Sorted Desc</option>
</select>
</label>

<label>Display <select id="displaySelectList" >
<option  value="1" >Shrunk</option>
<option  value="0" >Expanded</option> 
</select>

<label>Speed <select id="speedSelectList" >
<option  value="1500" >slow</option>
<option  value="600" >medium</option>
<option  value="100" >fast</option>
</select>


<button onclick="ExecuteQS()" >Start</button>
</div> 
<div  id="OutDiv" > 
</div>
<script>


var A;  // The input array for Quicksort
var paramStack; // A global array used as a stack 

var prevleft,prevright;
   
 var arr0 = "<span id='arr0' >&darr;</span>";
 var arr1 = "<span id='arr1' >&darr;</span>";
 

var Speed, Display;

var newRow;
var gelem1, gelem2;
 
var lo,  hi;
var left,right; 
var Timer1= null;
var dispLeft,dispRight;
 
var gLeftIndx, gRightIndx;
var pivotLoc; 


function ExecuteQS()
{ // The array A (global) is the input to Quicksort 
  
  if (Timer1) clearInterval(Timer1);
  Timer1 = null; 

  OutDiv.innerHTML = "";
  Speed = parseInt(speedSelectList.options[speedSelectList.selectedIndex].value);

  Display = parseInt(displaySelectList.options[displaySelectList.selectedIndex].value);
  var inpType = inpData.options[inpData.selectedIndex].value ;
  var n = parseInt(inpSize.options[inpSize.selectedIndex].value);
  //  alert(inpType);

  if (inpType == "Predefined")
  { 
    if (n==11)
       A = [0,27,52,64,60,98,30,24,15,66,90,16];
    // The "predefined" example for n=20 shows (first line of output) that the left arrow 
    // is not moving because its current location is where the right arrow will end up 
     else if (n==20) 
       A = [0,17,14,55,73,83,37,79,30,77,40,82,31,68,19,91,69,32,76,57,58];

     else
        A = [0,17,14,55,73,83,37,79,30,77,40,82,31,68,19,91,69,32,76,57,58, 33,17,29,51,83,23,67,11,43,19];
   
    //  n=11;
    // A = [0,33,17,29,51,83,23,67,11,43,19,71];  

// n=20;
// A = [0,89,88,86,85,79,69,65,61,61,53,48,46,44,37,34,18,16,13,12,10];

   }


   if (inpType != "Predefined")
   {  A = new Array();
      for(var i=0; i<=n; i++)
      { A[i] = Math.floor(Math.random()*90+10); }
   }

   if (inpType == "SortedAs")
   {  A.sort(); }

   if (inpType == "SortedDs")
   {  A.sort(); 
      for(var i=0; i<=Math.floor(n/2); i++) 
      { var t = A[i]; A[i] = A[n-i]; A[n-i] = t; }
   }

  paramStack=[]; // paramStack array is global
  var B = A.slice(); // Make a duplicate of array A
  Quicksort(A,1,A.length-1);
 
  A = B.slice(); // Restore array A 
  ProcessStack(); 
}

function Quicksort(A, lo , hi) 
{  if (lo < hi) 
   {  var mid = Partition(A,lo,hi);
      Quicksort(A,lo,mid-1);
      Quicksort(A,mid+1,hi);
   } 
} 

function Partition( A, lo, hi)
{// Input: An integer array A[lo..hi]  
 // Output: The elements arranged as: elements <= pivot, pivot, elements > pivot;
 // Return the final position of pivot 
 // Assume pivot is A[lo] but it can be any of the elements A[lo], ..., A[hi];
 // If pivot is other than A[lo] then (at the start) swap it with A[lo]

   paramStack.push([-lo,hi]); // push lo and hi 
   var pivot = A[lo];   
   var left = lo+1; 
   var right = hi;
   while (left <= right)
   {  while ((left <= right) && (A[left] <= pivot)) left++;
      while ((left <= right) && (A[right] > pivot)) right--;
      if (left < right)
      {  // save left and right parameters to paramStack array 
         paramStack.push([left,right]);
         var t = A[left]; A[left] = A[right]; A[right] = t; left++; right--; 
      }
   }
  
   // Final swap: swap pivot with A[right] and return right (final pivot location) 
   A[lo] = A[right]; A[right] = pivot;
   paramStack.push([lo,right]); // push lo and right 
   return right;
}


function ProcessStack()
{  var elem = document.getElementById("arr0");
   if (elem) elem.parentNode.removeChild(elem); 
   elem = document.getElementById("arr1");
   if (elem) elem.parentNode.removeChild(elem); 

   if (paramStack.length==0)  
   { PrintArray(A,-1,0); return; }
    
   gelem1 = null; gelem2 = null;
   newRow = false;
   var param = paramStack.shift(); // Get parameters from paramStack
    
   left = param[0]; right = param[1]; 
   
   if (left < 0)  // Check if parameters are lo and hi
   {  newRow =true;
      lo = -left;  hi = right; 
     
      prevleft = lo;  // a bug creeps if RHS is lo+1
      prevright = hi;
 
      param = paramStack.shift();  
     
      left = param[0]; right = param[1]; 
   } 
       
   dispLeft = left-prevleft; // no. of cells to move left arraow
   dispRight = prevright-right ; // no. of cells to move right arraow
   
   if (left==lo) dispLeft = right - prevleft;
   
   PrintArray(A, prevleft, prevright);
 
   prevright = right; prevleft = left;

   // Modify the array; the modified array will be shown the 
   // next time ProcessStack() (and thus PrintArray) is called
   var t = A[left]; A[left] = A[right]; A[right] = t; 
  
   if (!Timer1) Timer1 = setInterval(AnimateArrow,Speed); // Start animation
} 


function PrintArray(A, prevleft, prevright)
{  // This function renders the array A as an HTML list
  
   var finish = (prevleft==-1);
   if (finish) { lo=0; hi=0; newRow=true;}
 
  var x =  "";
 
  for(var i= 1; i < A.length ; i++)
  {  var st = ""; 
     if ( (i>=lo)  &&  (i <=hi)) st = "style='background-color:lightgray'";
      
     var ext ="";
    
     if (i==prevleft ) 
     {  ext = arr0; gLeftIndx = i; st = "style='background-color:white'";   }
     if (i==prevright )
     { ext = arr1; gRightIndx = i; st  = "style='background-color:white'";  }
    
     if (i==lo) st += " class ='pivot'"; 
     x += "<li " + st + ">" + A[i] + ext + "</li>"; 
  } 
  
  if (Display && (!newRow) )
  {  elems = document.getElementsByTagName("ul");
     elem = elems[elems.length-1];
     if (elem) elem.parentNode.removeChild(elem); 
  } 
  
  var Info = ""; 
 
  if (Display && !finish)  // Shrunk display has lo/hi/mid info
  {   Info="<span class='info' >"  + lo + " : "  + hi + " : ? " + "</span>" ; 
      elems = document.getElementsByTagName("span");
      elem = elems[elems.length-1];
      if (newRow )  // set pivot in previous line
      { if (elem) elem.innerHTML = elem.innerHTML.replace("?",pivotLoc );  } 
      else if (elem) elem.parentNode.removeChild(elem); 
   } 

   OutDiv.innerHTML += Info + "<ul>"  + x + "</ul>"; 

   if (lo==left) pivotLoc = right;
   
   if (finish)
   {  if (Display)
      { elems = document.getElementsByTagName("span");
        elem = elems[elems.length-1];
        elem.innerHTML = elem.innerHTML.replace("?",pivotLoc);  
      }
 
      elems = document.getElementsByTagName("ul");
      elem = elems[elems.length-1];
      elem.className = "finalarray";
   } 
}
  
 
function AnimateArrow()
{  // This function is called as a result of 
   // the call to setInterval() in ProcessSatck() 

    if (( dispLeft < -1) && ( dispRight < -1))  
    {  clearInterval(Timer1); Timer1 = null; ProcessStack(); return; }
 
    var elems = document.getElementsByTagName("ul");
    var lastList = elems[elems.length-1];

    if (( dispLeft == -1) && ( dispRight == -1))
    {   lastList.getElementsByTagName("li")[left-1].style.backgroundColor="yellow"; 
        dispLeft = -2; dispRight = -2;
        return;
    }

    arr_elem = document.getElementById("arr0");
    styleInfo = window.getComputedStyle(arr_elem);
    pos = parseInt(styleInfo.left); 
 
    pos = pos + 31;
    if ( dispLeft > 0) 
    {  dispLeft--;  
        if (gelem1) gelem1.style.backgroundColor="lightgray";  
         else lastList.getElementsByTagName("li")[gLeftIndx-1].style.backgroundColor="lightgray";  
       gelem1 = lastList.getElementsByTagName("li")[gLeftIndx];
        if  (gLeftIndx  < right ) 
          if (gelem1.style.backgroundColor!="yellow") gelem1.style.backgroundColor="white"; //keep condition
       // else gelem2= gelem1; 
      //  if (right - gLeftIndx  <= 2) pos -=1; // to avoid blue/red arrows overlapping
       arr_elem.style.left = pos  + "px";  
       gLeftIndx++; 
    }
    else  if (dispLeft==0) 
    {   lastList.getElementsByTagName("li")[gLeftIndx-1].style.backgroundColor="yellow"; 
       dispLeft =-1;
    } 

   arr_elem  = document.getElementById("arr1");
   styleInfo = window.getComputedStyle(arr_elem);
   pos = parseInt(styleInfo.left);
   pos = pos - 31;
 
   if (dispRight > 0)
   {   dispRight--; 
        
       if (gelem2)  gelem2.style.backgroundColor="lightgray";  
       else lastList.getElementsByTagName("li")[gRightIndx-1].style.backgroundColor="lightgray";  

       gelem2 = lastList.getElementsByTagName("li")[right+dispRight-1];

        if (gelem2.style.backgroundColor!="yellow")  gelem2.style.backgroundColor="white";

       if ((right - gLeftIndx <= 2) && (dispRight<=1))  pos +=2; // to avoid blue/red arrows overlapping
       arr_elem.style.left = pos  + "px";    
   } 
    else if  (dispRight==0) 
   {  // if (gelem2) gelem2.style.backgroundColor="lightgray"; 
     //  else lastList.getElementsByTagName("li")[gRightIndx-1].style.backgroundColor="lightgray";   
     
       lastList.getElementsByTagName("li")[right-1].style.backgroundColor="yellow";   
      dispRight =-1;
         
   }   
    
}
//var A = [0,33,17,29,51,83,23,67,11,43,19,71];
//Quicksort(A,1,A.length-1);
// ExecuteQS();
 
</script>
</body>
</html>